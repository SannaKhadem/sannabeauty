<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Image Dashboard</title>
  <link rel="stylesheet" href="/css/styles.css">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f7f7f7;
      margin: 0;
      padding: 0;
    }
    .dashboard-container {
      max-width: 1200px;
      margin: 40px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.10);
      padding: 2rem;
    }
    .treatment-section {
      margin-bottom: 2.5rem;
    }
    .treatment-title {
      font-size: 3rem;
      color: #4e184f;
      margin-bottom: 1rem;
      border-bottom: 2px solid #eee;
      padding-bottom: 0.5rem;
    }
    .group-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
      align-items: flex-start;
    }
    .group-title {
      font-size: 1.1rem;
      color: #602547;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }
    .image-card {
      background: #fafafa;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      padding: 1rem;
      text-align: center;
      position: relative;
      min-width: 180px;
      max-width: 220px;
    }
    .image-card img {
      max-width: 180px;
      height: auto;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      box-shadow: 0 1px 4px rgba(0,0,0,0.10);
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .image-card {
      background: #fafafa;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.07);
      padding: 1rem;
      text-align: center;
      position: relative;
    }
    .image-card img {
      max-width: 120px;
      height: auto;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      box-shadow: 0 1px 4px rgba(0,0,0,0.10);
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .image-details {
      font-size: 0.95rem;
      color: #555;
      margin-bottom: 0.5rem;
    }
    .delete-btn {
      background: #ee9acb;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 0.4rem 1rem;
      cursor: pointer;
      font-size: 0.95rem;
      margin-top: 0.5rem;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background: #e76ec4;
    }
    .upload-link {
      display: inline-block;
      margin-top: 2rem;
      color: #a65278;
      font-weight: bold;
      text-decoration: none;
      font-size: 1.1rem;
    }
    .upload-link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <h1 style="text-align:center; color:#300c24; margin-bottom:2rem;">Bildhantering – Dashboard</h1>
    <% if (images.length === 0) { %>
      <p style="text-align:center;">Inga bilder har laddats upp än.</p>
    <% } else { %>
      <% const treatments = {};
         images.forEach(img => {
           const t = img.treatment || (img.parsed && img.parsed.treatment) || 'Övrigt';
           if (!treatments[t]) treatments[t] = [];
           treatments[t].push(img);
         });
      %>
      <% Object.entries(treatments).forEach(([treatment, imgs]) => {
           // Group images by 'group' value
           const groups = {};
           imgs.forEach(img => {
             const group = img.group != null ? img.group : 'Övrigt';
             if (!groups[group]) groups[group] = [];
             groups[group].push(img);
           });
      %>
        <section class="treatment-section">
          <div class="treatment-title"><%= treatment.charAt(0).toUpperCase() + treatment.slice(1) %></div>
          <% Object.entries(groups).forEach(([groupId, groupImgs]) => { %>
            <div class="group-title">Grupp: <%= groupId %></div>
            <div class="group-row">
              <% groupImgs.forEach(image => { %>
                <div class="image-card">
                  <img src="<%= image.path %>" alt="<%= image.description || image.phase || '' %>">
                  <div class="image-details">
                    <% if (image.phase) { %><strong>Fas:</strong> <%= image.phase %><br><% } %>
                    <% if (image.description) { %><strong>Beskrivning:</strong> <%= image.description %><br><% } %>
                  </div>
                  <form action="/admin/delete/<%= image._id %>" method="POST" onsubmit="return confirm('Är du säker på att du vill ta bort denna bild?');">
                    <button type="submit" class="delete-btn">Ta bort</button>
                  </form>
                </div>
              <% }) %>
            </div>
          <% }) %>
        </section>
      <% }) %>
    <% } %>
    <a href="/admin/upload" class="upload-link"><i class="fa fa-upload"></i> Ladda upp ny bild</a>
  </div>
</body>
</html>
